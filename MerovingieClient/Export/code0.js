gdjs.NewSceneCode = {};
gdjs.NewSceneCode.GDworkerObjects1= [];
gdjs.NewSceneCode.GDworkerObjects2= [];
gdjs.NewSceneCode.GDworkerObjects3= [];
gdjs.NewSceneCode.GDworkerObjects4= [];
gdjs.NewSceneCode.GDmessageObjects1= [];
gdjs.NewSceneCode.GDmessageObjects2= [];
gdjs.NewSceneCode.GDmessageObjects3= [];
gdjs.NewSceneCode.GDmessageObjects4= [];
gdjs.NewSceneCode.GDmessage2Objects1= [];
gdjs.NewSceneCode.GDmessage2Objects2= [];
gdjs.NewSceneCode.GDmessage2Objects3= [];
gdjs.NewSceneCode.GDmessage2Objects4= [];
gdjs.NewSceneCode.GDItemBoardLabelObjects1= [];
gdjs.NewSceneCode.GDItemBoardLabelObjects2= [];
gdjs.NewSceneCode.GDItemBoardLabelObjects3= [];
gdjs.NewSceneCode.GDItemBoardLabelObjects4= [];
gdjs.NewSceneCode.GDtreeObjects1= [];
gdjs.NewSceneCode.GDtreeObjects2= [];
gdjs.NewSceneCode.GDtreeObjects3= [];
gdjs.NewSceneCode.GDtreeObjects4= [];
gdjs.NewSceneCode.GDBackgroundObjects1= [];
gdjs.NewSceneCode.GDBackgroundObjects2= [];
gdjs.NewSceneCode.GDBackgroundObjects3= [];
gdjs.NewSceneCode.GDBackgroundObjects4= [];
gdjs.NewSceneCode.GDUIPanelObjects1= [];
gdjs.NewSceneCode.GDUIPanelObjects2= [];
gdjs.NewSceneCode.GDUIPanelObjects3= [];
gdjs.NewSceneCode.GDUIPanelObjects4= [];
gdjs.NewSceneCode.GDSelectedMarkerObjects1= [];
gdjs.NewSceneCode.GDSelectedMarkerObjects2= [];
gdjs.NewSceneCode.GDSelectedMarkerObjects3= [];
gdjs.NewSceneCode.GDSelectedMarkerObjects4= [];
gdjs.NewSceneCode.GDtownHallObjects1= [];
gdjs.NewSceneCode.GDtownHallObjects2= [];
gdjs.NewSceneCode.GDtownHallObjects3= [];
gdjs.NewSceneCode.GDtownHallObjects4= [];
gdjs.NewSceneCode.GDBuildButtonObjects1= [];
gdjs.NewSceneCode.GDBuildButtonObjects2= [];
gdjs.NewSceneCode.GDBuildButtonObjects3= [];
gdjs.NewSceneCode.GDBuildButtonObjects4= [];
gdjs.NewSceneCode.GDGoldStockLabelObjects1= [];
gdjs.NewSceneCode.GDGoldStockLabelObjects2= [];
gdjs.NewSceneCode.GDGoldStockLabelObjects3= [];
gdjs.NewSceneCode.GDGoldStockLabelObjects4= [];
gdjs.NewSceneCode.GDStoneStockLabelObjects1= [];
gdjs.NewSceneCode.GDStoneStockLabelObjects2= [];
gdjs.NewSceneCode.GDStoneStockLabelObjects3= [];
gdjs.NewSceneCode.GDStoneStockLabelObjects4= [];
gdjs.NewSceneCode.GDWoodStockLabelObjects1= [];
gdjs.NewSceneCode.GDWoodStockLabelObjects2= [];
gdjs.NewSceneCode.GDWoodStockLabelObjects3= [];
gdjs.NewSceneCode.GDWoodStockLabelObjects4= [];
gdjs.NewSceneCode.GDGoldStockIconObjects1= [];
gdjs.NewSceneCode.GDGoldStockIconObjects2= [];
gdjs.NewSceneCode.GDGoldStockIconObjects3= [];
gdjs.NewSceneCode.GDGoldStockIconObjects4= [];
gdjs.NewSceneCode.GDStoneStockIconObjects1= [];
gdjs.NewSceneCode.GDStoneStockIconObjects2= [];
gdjs.NewSceneCode.GDStoneStockIconObjects3= [];
gdjs.NewSceneCode.GDStoneStockIconObjects4= [];
gdjs.NewSceneCode.GDWoodStockIconObjects1= [];
gdjs.NewSceneCode.GDWoodStockIconObjects2= [];
gdjs.NewSceneCode.GDWoodStockIconObjects3= [];
gdjs.NewSceneCode.GDWoodStockIconObjects4= [];
gdjs.NewSceneCode.GDMaxPopulationIconObjects1= [];
gdjs.NewSceneCode.GDMaxPopulationIconObjects2= [];
gdjs.NewSceneCode.GDMaxPopulationIconObjects3= [];
gdjs.NewSceneCode.GDMaxPopulationIconObjects4= [];
gdjs.NewSceneCode.GDcarryObjects1= [];
gdjs.NewSceneCode.GDcarryObjects2= [];
gdjs.NewSceneCode.GDcarryObjects3= [];
gdjs.NewSceneCode.GDcarryObjects4= [];
gdjs.NewSceneCode.GDmineObjects1= [];
gdjs.NewSceneCode.GDmineObjects2= [];
gdjs.NewSceneCode.GDmineObjects3= [];
gdjs.NewSceneCode.GDmineObjects4= [];
gdjs.NewSceneCode.GDfarmObjects1= [];
gdjs.NewSceneCode.GDfarmObjects2= [];
gdjs.NewSceneCode.GDfarmObjects3= [];
gdjs.NewSceneCode.GDfarmObjects4= [];
gdjs.NewSceneCode.GDrallyPointObjects1= [];
gdjs.NewSceneCode.GDrallyPointObjects2= [];
gdjs.NewSceneCode.GDrallyPointObjects3= [];
gdjs.NewSceneCode.GDrallyPointObjects4= [];
gdjs.NewSceneCode.GDErrorLabelObjects1= [];
gdjs.NewSceneCode.GDErrorLabelObjects2= [];
gdjs.NewSceneCode.GDErrorLabelObjects3= [];
gdjs.NewSceneCode.GDErrorLabelObjects4= [];
gdjs.NewSceneCode.GDbuildingResourceLabelObjects1= [];
gdjs.NewSceneCode.GDbuildingResourceLabelObjects2= [];
gdjs.NewSceneCode.GDbuildingResourceLabelObjects3= [];
gdjs.NewSceneCode.GDbuildingResourceLabelObjects4= [];
gdjs.NewSceneCode.GDTitleResourcesLabelObjects1= [];
gdjs.NewSceneCode.GDTitleResourcesLabelObjects2= [];
gdjs.NewSceneCode.GDTitleResourcesLabelObjects3= [];
gdjs.NewSceneCode.GDTitleResourcesLabelObjects4= [];
gdjs.NewSceneCode.GDTitleActionsLabelObjects1= [];
gdjs.NewSceneCode.GDTitleActionsLabelObjects2= [];
gdjs.NewSceneCode.GDTitleActionsLabelObjects3= [];
gdjs.NewSceneCode.GDTitleActionsLabelObjects4= [];
gdjs.NewSceneCode.GDMaxPopulationLabelObjects1= [];
gdjs.NewSceneCode.GDMaxPopulationLabelObjects2= [];
gdjs.NewSceneCode.GDMaxPopulationLabelObjects3= [];
gdjs.NewSceneCode.GDMaxPopulationLabelObjects4= [];

gdjs.NewSceneCode.conditionTrue_0 = {val:false};
gdjs.NewSceneCode.condition0IsTrue_0 = {val:false};
gdjs.NewSceneCode.condition1IsTrue_0 = {val:false};
gdjs.NewSceneCode.condition2IsTrue_0 = {val:false};
gdjs.NewSceneCode.condition3IsTrue_0 = {val:false};
gdjs.NewSceneCode.condition4IsTrue_0 = {val:false};
gdjs.NewSceneCode.condition5IsTrue_0 = {val:false};
gdjs.NewSceneCode.condition6IsTrue_0 = {val:false};
gdjs.NewSceneCode.condition7IsTrue_0 = {val:false};
gdjs.NewSceneCode.conditionTrue_1 = {val:false};
gdjs.NewSceneCode.condition0IsTrue_1 = {val:false};
gdjs.NewSceneCode.condition1IsTrue_1 = {val:false};
gdjs.NewSceneCode.condition2IsTrue_1 = {val:false};
gdjs.NewSceneCode.condition3IsTrue_1 = {val:false};
gdjs.NewSceneCode.condition4IsTrue_1 = {val:false};
gdjs.NewSceneCode.condition5IsTrue_1 = {val:false};
gdjs.NewSceneCode.condition6IsTrue_1 = {val:false};
gdjs.NewSceneCode.condition7IsTrue_1 = {val:false};


gdjs.NewSceneCode.userFunc0x68d328 = function(runtimeScene) {

    function MerovingieWebSocket() {
        this.scheme = document.location.protocol === "https:" ? "wss" : "ws";
        this.port = document.location.port ? (":" + document.location.port) : "";
        const urlParams = new URLSearchParams(window.location.search);
        this.gameName = urlParams.get('name');
  
        // Variable de connexion qui contient l'adresse du serveur
        this.connectionUrl = this.scheme + "://" + document.location.hostname + this.port + "/ws";
  
        // Connecte le websocket au serveur
        this.socket = new WebSocket(this.connectionUrl);
  
        // Ouverture du socket
        this.socket.onopen = function () {
            if (!this || this.readyState !== WebSocket.OPEN) {
                alert("meroSocket is not connected");
                return;
            }
  
            var connectMessage = new MMessage(MessageTypes.GAMECONNECT_DEMAND, "");
  
            if (this.OPEN)
            {
                try {
                    this.send(JSON.stringify(connectMessage));
                }
                catch (err){
                    console.error('Socket error on opening: \n');
                    console.error(err);
                }
            }
        }
  
        this.socket.onmessage = function (event) {
            var messageReceived = JSON.parse(event.data);
            console.log(messageReceived);
  
            if (!messageReceived.Type)
                console.error("Socket OnMessage: the format of the message is not correct :" + JSON.stringify(messageReceived));
            else
            {
                var message = new MMessage(messageReceived.Type, messageReceived.Message);
                gdjs.ProcessMessage(message);
            }
        }
  
        this.socket.onclose = function(event) {
            console.log(event);
        }
    }
  
    // Méthode d'envoi de données
    MerovingieWebSocket.prototype.send = function(messageType, body) {
  
        if (!messageType) {
            alert('Message type is undefined of null');
            return;
        }
  
        if (!body) {
            alert('Body of message is undefined or null');
        }
  
      if (typeof(body) === 'string')
          var message = body;
      else
          var message = JSON.stringify(body);
  
        var i = 0;
      for (i = 0; i < message.length ; i += 3000)
      {
        if (i+3000 > message.length) var bytes = message.substr(i, message.length);
        else var bytes = message.substr(i, i+3000);
        
        try {
            console.log('Sending message to server: \n');
            console.log(messageType);
            console.log(bytes);
            console.log('\n');
            this.socket.send(JSON.stringify(new MMessage(messageType, bytes)));
        }
        catch (err) {
            console.error('Socket error on opening: \n');
            console.error(err);
        }
      }
        
    //   console.log(this.socket.bufferedAmount);
    }
    
    gdjs.ProcessMessage = function(messageToInterpret)
    {
        console.log(messageToInterpret.message);
  
        var messageBody = '';
  
        if (messageToInterpret.message && messageToInterpret.message.length > 0) {
            try {
                console.log('Receiving message from server: \n');
                console.log(messageToInterpret.message);
                console.log('\n');
                messageBody = JSON.parse(messageToInterpret.message);
            }
            catch (err) {
                console.error('Socket error on opening: \n');
                console.error(err);
            }
        }
  
        switch(messageToInterpret.type) {
  
            case MessageTypes.GAMECONNECT_OK:
                // TODO: créer une fonction de chargement de partie
                // et l'attacher à meroSocket
                gdjs.meroSocket.send(MessageTypes.FILELOAD_REQUESTED, gdjs.meroSocket.gameName);
                break;
  
            case MessageTypes.FILELOAD_ACCEPTED:
                gdjs.loadData(messageBody);
                runtimeScene.getObjects("tree").forEach(function(t) {
                    gdjs.setRallyPoint(t);
                });
                gdjs.saveData();
                setInterval(function() {gdjs.sendUnitsState()}, 2500);
                break;
  
            case MessageTypes.CREATION_REFUSEDPOPULATION:
                gdjs.displayError("Not enough farms!");
                break;
  
            case MessageTypes.CREATION_REFUSEDRESOURCES:
                gdjs.displayError("Not enough resources!");
                break;
  
            case MessageTypes.CREATION_ACCEPTED:
                gdjs.updateStock(messageBody);
                break;
  
            case MessageTypes.CREATION_COMPLETED:
                gdjs.createWorker(null, messageBody.Position.x, messageBody.Position.y);
                var actualPopulation = runtimeScene.getVariables().get("ActualPopulation").getAsNumber();
                runtimeScene.getVariables().get("ActualPopulation").setNumber(actualPopulation + 1);
                gdjs.updatePopulationLabel();
                break;

            case MessageTypes.FETCHWAY_COMPLETED:
                var unit = gdjs.fetchCompleted(messageBody);
                gdjs.sendUnitToBringResources(unit);
                break;

            case MessageTypes.FETCHBACK_COMPLETED:
                var unit = gdjs.releaseCompleted(messageBody);
                gdjs.sendUnitToFetchResources(unit);
                break;

            case MessageTypes.INFO_UPDATESTOCK:
                gdjs.updateStock(messageBody);
                break;
            
            default: break;
        }
    }
  
    // Fonction qui traite de chargement de données
    gdjs.loadData = function(data, callback) {
        console.log(data);
        var gameDescriptor = new MGameFileDescriptor(data);
        // Tester la nullité et envoyer un message d'erreur au serveur si nécessaire
        // if (isNullOrUndefined(gameDescriptor)) gdjs.meroSocket.send(new MF)
  
        gameDescriptor.carries.forEach((carry) => gdjs.createCarry(carry));
        gameDescriptor.goldMines.forEach((mine) => gdjs.createGoldMine(mine));
        gameDescriptor.farms.forEach((farm) => gdjs.createFarm(farm));
        gameDescriptor.townHalls.forEach((townHall) => gdjs.createTownHall(townHall));
        gameDescriptor.workers.forEach((worker) => gdjs.createWorker(worker));
        gdjs.updateStock(gameDescriptor.resources);
        runtimeScene.getVariables().get("MaxPopulation").setNumber(gameDescriptor.maxPopulation);
        runtimeScene.getVariables().get("ActualPopulation").setNumber(gameDescriptor.actualPopulation);
        gdjs.updatePopulationLabel();

        if (callback) callback();
    }
  
    // Fonction de sauvegarde de données
      gdjs.saveData = function() {
          var carries = [];
          var trees = [];
          var goldMines = [];
          var townHalls = [];
          var farms = [];
          var workers = [];
  
          runtimeScene.getObjects("carry").forEach((item) => {
              carries.push( { 
                  Id : item.getUniqueId(),
                  RallyPoint: { X: item.getVariables()._variables.items.RallyPointX, Y: item.getVariables()._variables.items.RallyPointY },
                  Position : { X: item.getX(), Y: item.getY() }
              });
          });
  
          var message_part1 = { 
              "gameName": gdjs.meroSocket.gameName, 
              "carries" : carries,
              "trees" : [],
              "goldMines" : [],
              "townHalls" : [],
              "farms" : [],
              "workers" : []
          }
  
          gdjs.meroSocket.send(MessageTypes.FILESAVE_REQUESTED_FIRSTPART, message_part1);    
  
  
          runtimeScene.getObjects("mine").forEach((item) => {
              goldMines.push( { 
                      Id : item.getUniqueId(),
                      RallyPoint: { X: item.getVariables()._variables.items.RallyPointX, Y: item.getVariables()._variables.items.RallyPointY },
                      Position : { X: item.getX(), Y: item.getY() }
                  });
              });
  
          var message_part2 = { 
              "gameName": gdjs.meroSocket.gameName, 
              "carries" : [],
              "trees" : [],
              "goldMines" : goldMines,
              "townHalls" : [],
              "farms" : [],
              "workers" : []
          }
  
          gdjs.meroSocket.send(MessageTypes.FILESAVE_REQUESTED_NEXTPART, message_part2);
  
  
          runtimeScene.getObjects("townHall").forEach((item) => {
              townHalls.push( { 
                  Id : item.getUniqueId(), 
                  RallyPoint: { X: item.getVariables()._variables.items.RallyPointX, Y: item.getVariables()._variables.items.RallyPointY },
                  Position : { X: item.getX(), Y: item.getY() }
              });
          });
  
          var message_part2 = { 
              "gameName": gdjs.meroSocket.gameName, 
              "carries" : [],
              "trees" : [],
              "goldMines" : [],
              "townHalls" : townHalls,
              "farms" : [],
              "workers" : []
          }
  
          gdjs.meroSocket.send(MessageTypes.FILESAVE_REQUESTED_NEXTPART, message_part2);
  
          runtimeScene.getObjects("farm").forEach((item) => {
              farms.push( { 
                  Id : item.getUniqueId(), 
                  Position : { X: item.getX(), Y: item.getY() }
              });
          });
  
          var message_part2 = { 
              "gameName": gdjs.meroSocket.gameName, 
              "carries" : [],
              "trees" : [],
              "goldMines" : [],
              "townHalls" : [],
              "farms" : farms,
              "workers" : []
          }
  
          gdjs.meroSocket.send(MessageTypes.FILESAVE_REQUESTED_NEXTPART, message_part2);
  
  
          runtimeScene.getObjects("worker").forEach((item) => {
              workers.push( { 
                  Id : item.getUniqueId(),
                  Position : { X: item.getX(), Y: item.getY() }
              });
          });
  
          var message_part2 = { 
              "gameName": gdjs.meroSocket.gameName, 
              "carries" : [],
              "trees" : [],
              "goldMines" : [],
              "townHalls" : [],
              "farms" : [],
              "workers" : workers
          }
  
          gdjs.meroSocket.send(MessageTypes.FILESAVE_REQUESTED_NEXTPART, message_part2);
  
  
      var treeObjects = runtimeScene.getObjects("tree");
      var i = 0;
      for (i=0; i < treeObjects.length; i+=20)
      {
          for(j = i; j < i+20 && j <  treeObjects.length; j++)
          {
            //   setTimeout(() => {
                trees.push( { 
                    Id : treeObjects[j].getUniqueId(),
                    Name : treeObjects[j].getName(),
                    RallyPoint: { X: treeObjects[j].getVariables()._variables.items.RallyPointX, Y: treeObjects[j].getVariables()._variables.items.RallyPointY },
                    Position : { X: treeObjects[j].getX(), Y: treeObjects[j].getY() }
                });
            //   }, 5);
          }
          var message_part2 = { 
              "gameName": gdjs.meroSocket.gameName, 
              "carries" : [],
              "trees" : trees,
              "goldMines" : [],
              "townHalls" : [],
              "farms" : [],
              "workers" : []
          }
  
          gdjs.meroSocket.send(MessageTypes.FILESAVE_REQUESTED_NEXTPART, message_part2);
          trees=[];
      };
  
      gdjs.meroSocket.send(MessageTypes.FILESAVE_REQUESTED_END, "end");
    }
  
    // Fonction de création d'une Carrière de pierre
    gdjs.createCarry = function(carry) {
        var newCarry = runtimeScene.createObject("carry");
        newCarry.setPosition(carry.Position.x, carry.Position.y);
        newCarry._variables._variables.items.Stock._value = carry.StoneStock;
        gdjs.setRallyPoint(newCarry);
        newCarry.setZOrder(1);
    }
  
      // Fonction de création d'une Ferme
    gdjs.createFarm = function(farm) {
        var newFarm = runtimeScene.createObject("farm");
        newFarm.setPosition(farm.Position.x, farm.Position.y);
        newFarm.setZOrder(1);
    }
  
    // Fonction de création d'une mine d'or'
    gdjs.createGoldMine = function(goldMine) {
        var newGoldMine = runtimeScene.createObject("mine");
        newGoldMine.setPosition(goldMine.Position.x, goldMine.Position.y);
        gdjs.setRallyPoint(newGoldMine);
        newGoldMine.setZOrder(1);
    }
  
    // Fonction de création d'une mine d'or'
    gdjs.createTownHall = function(townHall) {
        var newTownHall = runtimeScene.createObject("townHall");
        newTownHall.setPosition(townHall.Position.x, townHall.Position.y);
        gdjs.setRallyPoint(newTownHall);
        newTownHall.setZOrder(1);
    }
  
    // Fonction de création d'un worker
    gdjs.createWorker = function(worker, x, y) {
        var newWorker = runtimeScene.createObject("worker");
        if (!worker || !worker.Position || (worker.Position.x === 0 && worker.Position.y === 0))
        {
            var townHall = runtimeScene.getObjects("townHall");
            if (townHall.length > 0)
                newWorker.setPosition(townHall[0].getVariables()._variables.items.RallyPointX, townHall[0].getVariables()._variables.items.RallyPointY );
            else
                newWorker.setPosition(x, y);
        }
        else
        {
            newWorker.setPosition(worker.Position.x, worker.Position.y);
        }
        newWorker.setZOrder(10);
        gdjs.setNewCoordinatesForUnit(newWorker);
    }
  
    // Fonction de mise à jour du stock
    gdjs.updateStock = function(stock) {
        var goldStockLabel = runtimeScene.getObjects("GoldStockLabel");
        var stoneStockLabel = runtimeScene.getObjects("StoneStockLabel");
        var woodStockLabel = runtimeScene.getObjects("WoodStockLabel");
  
        if (goldStockLabel.length > 0) goldStockLabel[0].setString(stock.Gold);
        if (stoneStockLabel.length > 0) stoneStockLabel[0].setString(stock.Stone);
        if (woodStockLabel.length > 0) woodStockLabel[0].setString(stock.Wood);
    }
  
    // Fonction de mise à jour du label de population
    gdjs.updatePopulationLabel = function()
    {
        /** @type {gdjs.RuntimeObject} */
        var populationLabel = runtimeScene.getObjects("MaxPopulationLabel")[0];
        
        var maxPopulation = runtimeScene.getVariables().get("MaxPopulation").getAsNumber();
        var actualPopulation = runtimeScene.getVariables().get("ActualPopulation").getAsNumber();
        
        populationLabel.setString(actualPopulation + ' / ' + maxPopulation);
    }

    // Fonction d'affichage d'erreur sur l'interface
    gdjs.displayError = function(errorMessage) {
        var errorLabel = runtimeScene.getObjects("ErrorLabel");
        errorLabel[0].setString(errorMessage);
        errorLabel[0].hide(false);
        setTimeout(function() {
            errorLabel[0].hide(true);
        }, 2000);
    }
    
    //
    gdjs.sendUnitsState = function() {
        var workers = [];
  
        runtimeScene.getObjects("worker").forEach(function(wk) {
            var currentWorker = { id : wk.getUniqueId(), position : { x: wk.x, y: wk.y }  };
            workers.push(currentWorker);
        });
  
        this.meroSocket.send(MessageTypes.CLIENTDATA_UNITSSTATE, workers);
    }

    //
    gdjs.setNewCoordinatesForUnit = function(unit) {

        if (!typeof(unit) === 'runtimeObject') { console.log("wrong type of object"); return; }

        var units = runtimeScene.getObjects("worker");
        units.forEach(function(u) {
            console.log(u.separateFromObjects(units));
        });
        units.forEach(function(u) {
            console.log(u.separateFromObjects(units));
        }); 
    }

    //
    gdjs.setRallyPoint = function(object) {
        if (!typeof(object) === 'runtimeObject') { console.log("wrong type of object"); return; }

        var allObstacleObjects = [];
        runtimeScene.getObjects("worker").forEach(function(x) {
            allObstacleObjects.push(x);
        });
        runtimeScene.getObjects("tree").forEach(function(x) {
            allObstacleObjects.push(x);
        });
        runtimeScene.getObjects("townHall").forEach(function(x) {
            allObstacleObjects.push(x);
        });
        runtimeScene.getObjects("farm").forEach(function(x) {
            allObstacleObjects.push(x);
        });
        runtimeScene.getObjects("mine").forEach(function(x) {
            allObstacleObjects.push(x);
        });
        runtimeScene.getObjects("carry").forEach(function(x) {
            allObstacleObjects.push(x);
        });

        var dummyRallyPoint = runtimeScene.createObject("rallyPoint");
        var mapCenter = this.getMapCenter();
        dummyRallyPoint.setPosition(mapCenter.x, mapCenter.y);

        var hitBoxPoints = object.getHitBoxes()[0].vertices;
        var hitBoxDummys = [];
        var dist;
        var closestBoxPoint;
        for (var i = 0; i < hitBoxPoints.length; i++)
        {
            hitBoxDummys.unshift(runtimeScene.createObject("rallyPoint"));
            hitBoxDummys[0].setPosition(hitBoxPoints[i][0], hitBoxPoints[i][1]);
            if (!dist || hitBoxDummys[0].getDistanceToObject(dummyRallyPoint) < dist)
            {
                dist = hitBoxDummys[0].getDistanceToObject(dummyRallyPoint);
                closestBoxPoint = { "x": this.getObjectCenterX(hitBoxDummys[0]), "y": this.getObjectCenterY(hitBoxDummys[0]) };
            }
            hitBoxDummys[0].deleteFromScene(runtimeScene);
        }

        object.getVariables()._variables.items.RallyPointX = Math.floor(closestBoxPoint.x);
        object.getVariables()._variables.items.RallyPointY = Math.floor(closestBoxPoint.y);
    }


    gdjs.meroSocket = new MerovingieWebSocket();

    //
    gdjs.getObjectCenterX = function(object) {
        return (object.getAABB().max[0] + object.getAABB().min[0]) /2;
    }

    //
    gdjs.getObjectCenterY = function(object) {
        return (object.getAABB().max[1] + object.getAABB().min[1]) /2;
    }

    //
    gdjs.getMapCenter = function() {
        // Calcule le centre de la map
        /** @type {gdjs.runtimeObject} */
        var back = runtimeScene.getObjects("Background")[0];

        return { "x": gdjs.getObjectCenterX(back), "y": gdjs.getObjectCenterY(back)};
    }

    //
    gdjs.launchFetchActivity = function(unit, building) {

        if (!unit || !building) console.error('launchFetchActivity: args are null');

        this.setupFetchActivity(unit, building);
        this.sendUnitToFetchResources(unit);
    }

    // Initialise les données pour lancer une activité de récolte
    gdjs.setupFetchActivity = function(unit, building)
    {
        const unitActivity = unit._variables._variables.items.Activity;

        // Initialise les infos du "batiment" dont on va extraire les ressources
        unitActivity._children.FetchableEntity._children.X._value = building._variables._variables.items.RallyPointX;
        unitActivity._children.FetchableEntity._children.Y._value = building._variables._variables.items.RallyPointY;
        unitActivity._children.FetchableEntity._children.Id._value = building.getUniqueId();

        // Initialise les infos du batiment où l'on va rapporter les ressources
        // TODO: améliorer la détection des rallypoint pour enlever le "+ 30"
        const townHall = runtimeScene.getObjects("townHall")[0];
        unitActivity._children.StoreHouse._children.X._value = townHall._variables._variables.items.RallyPointX + 30;
        unitActivity._children.StoreHouse._children.Y._value = townHall._variables._variables.items.RallyPointY;
        unitActivity._children.StoreHouse._children.Id._value = townHall.getUniqueId();
    }



    // Envoie la commande au PathFindingBehavior 
    // de faire bouger l'unité vers sa destination
    gdjs.sendUnitToDestination = function(unitParam, activityName)
    {
        /** @type {gdjs.RuntimeObject} */
        const unit = unitParam;
        const unitActivity = unit._variables._variables.items.Activity;

        // Ordonne à l'unité d'aller de se déplacer vers sa destination
        unit.getBehavior("Pathfinding").moveTo(runtimeScene, unitActivity.DestinationX, unitActivity.DestinationY);

        // Si un chemin a été trouvé, signale le fait 
        // d'aller chercher des ressources comme activité courante
        if (unit.getBehavior("Pathfinding")._pathFound === true && activityName && typeof activityName === 'string')
        {
            unitActivity._children.Name._str = activityName;
        }
    }

    // Envoie une unité chercher des ressources
    gdjs.sendUnitToFetchResources = function(unitParam)
    {
        /** @type {gdjs.RuntimeObject} */
        const unit = unitParam;
        const unitActivity = unit._variables._variables.items.Activity;

        // Copie les infos du batiment d'extraction comme nouvelle destination
        unitActivity.DestinationX = unitActivity._children.FetchableEntity._children.X._value;
        unitActivity.DestinationY = unitActivity._children.FetchableEntity._children.Y._value;
        unitActivity.DestinationId = unitActivity._children.FetchableEntity._children.Id._value;

        // Ordonne à l'unité d'aller de se déplacer 
        // vers le batiment de stockage
        this.sendUnitToDestination(unit, 'Fetch_Way');

        return unit;
    }

    // Envoie une unité rapporter ses ressources au batiment de stockage
    gdjs.sendUnitToBringResources = function(unitParam)
    {
        /** @type {gdjs.RuntimeObject} */
        const unit = unitParam;
        const unitActivity = unit._variables._variables.items.Activity;

        // Copie les infos du batiment de stockage comme nouvelle destination
        unitActivity.DestinationX = unitActivity._children.StoreHouse._children.X._value;
        unitActivity.DestinationY = unitActivity._children.StoreHouse._children.Y._value;
        unitActivity.DestinationId = unitActivity._children.StoreHouse._children.Id._value;

        // Ordonne à l'unité d'aller de se déplacer 
        // vers le batiment d'extraction
        this.sendUnitToDestination(unit, 'Fetch_Back');

        return unit;
    }

    //
    gdjs.fetchCompleted = function(message) {
        console.log('fetch completed: ' + JSON.stringify(message));

        if (!message.unitId || !message.buildingId || !message.resources || !(message.resources.Gold >= 0) || !(message.resources.Stone >= 0) || !(message.resources.Wood >= 0))
        {
            console.error('fetch completed: message wrong format');
        }

        // Récupères les entités confirmées par la collecte (pour l'instatnt, les workers uniquement)
        var unit = runtimeScene.getObjects("worker").find(unt => unt.getUniqueId() === message.unitId);
        if (!unit) {
            console.error('fetch completed: unit can not be found (' + unitId + ')');
        }

        var building;
        var resources = ["tree", "carry", "mine"];
        for (var i = 0; i < resources.length && !building; i++)
        {
            building = runtimeScene.getObjects(resources[i]).find(unt => unt.getUniqueId() === message.buildingId);
        }
        if (!building) {
            console.error('fetch completed: building can not be found (' + buildingId + ')');            
        }

        unit.hide(false);
        if (message.resources.Gold > 0)
        {

        }
        if (message.resources.Wood > 0)
        {

        }
        if (message.resources.Stone > 0)
        {
            unit._variables._variables.items.HoldedResources._children.Stone._value += message.resources.Stone;
            // TODO: vérifier que a quantité restante est suffisante
            // si non, appeler l'api pour mettre à jour le stock et revérifier
            // si toujours non, alors afficher une erreur
            building._variables._variables.items.Stock._value -= message.resources.Stone;
        }

        unit._variables._variables.items.Activity._children.Name._str = 'None';

        return unit;
    }

    gdjs.releaseCompleted = function (message)
    {
        console.log('release completed: ' + JSON.stringify(message));

        if (!message.unitId || !message.resources || !(message.resources.Gold >= 0) || !(message.resources.Stone >= 0) || !(message.resources.Wood >= 0))
        {
            console.error('fetch completed: message wrong format');
        }

        // Récupère les entités confirmées par la collecte (pour l'instant, les workers uniquement)
        var unit = runtimeScene.getObjects("worker").find(unt => unt.getUniqueId() === message.unitId);
        if (!unit) {
            console.error('release completed: unit can not be found (' + unitId + ')');
        }

        unit._variables._variables.items.Activity._children.Name._str = 'None';

        return unit;
    }
};
gdjs.NewSceneCode.eventsList0x6fcbb8 = function(runtimeScene) {

{


gdjs.NewSceneCode.userFunc0x68d328(runtimeScene);

}


}; //End of gdjs.NewSceneCode.eventsList0x6fcbb8
gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDtreeObjects3Objects = Hashtable.newFrom({"tree": gdjs.NewSceneCode.GDtreeObjects3});gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDtownHallObjects3Objects = Hashtable.newFrom({"townHall": gdjs.NewSceneCode.GDtownHallObjects3});gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDmineObjects3Objects = Hashtable.newFrom({"mine": gdjs.NewSceneCode.GDmineObjects3});gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDcarryObjects3Objects = Hashtable.newFrom({"carry": gdjs.NewSceneCode.GDcarryObjects3});gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDfarmObjects3Objects = Hashtable.newFrom({"farm": gdjs.NewSceneCode.GDfarmObjects3});gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDcarryObjects2Objects = Hashtable.newFrom({"carry": gdjs.NewSceneCode.GDcarryObjects2});gdjs.NewSceneCode.userFunc0x6888b8 = function(runtimeScene, objects) {

var currentWorker = objects[0];
var carry = runtimeScene.getObjects("carry").find(x => x._variables._variables.items.targeted._value === 1);

gdjs.launchFetchActivity(currentWorker, carry);

// nettoie
carry._variables._variables.items.targeted._value = 0;
};
gdjs.NewSceneCode.eventsList0x68d810 = function(runtimeScene) {

{

/* Reuse gdjs.NewSceneCode.GDworkerObjects2 */

var objects = [];
objects.push.apply(objects,gdjs.NewSceneCode.GDworkerObjects2);
gdjs.NewSceneCode.userFunc0x6888b8(runtimeScene, objects);

}


}; //End of gdjs.NewSceneCode.eventsList0x68d810
gdjs.NewSceneCode.eventsList0x5b59a0 = function(runtimeScene) {

{

gdjs.NewSceneCode.GDcarryObjects3.createFrom(runtimeScene.getObjects("carry"));
gdjs.NewSceneCode.GDfarmObjects3.createFrom(runtimeScene.getObjects("farm"));
gdjs.NewSceneCode.GDmineObjects3.createFrom(runtimeScene.getObjects("mine"));
gdjs.NewSceneCode.GDtownHallObjects3.createFrom(runtimeScene.getObjects("townHall"));
gdjs.NewSceneCode.GDtreeObjects3.createFrom(runtimeScene.getObjects("tree"));
gdjs.NewSceneCode.GDworkerObjects3.createFrom(runtimeScene.getObjects("worker"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
gdjs.NewSceneCode.condition2IsTrue_0.val = false;
gdjs.NewSceneCode.condition3IsTrue_0.val = false;
gdjs.NewSceneCode.condition4IsTrue_0.val = false;
gdjs.NewSceneCode.condition5IsTrue_0.val = false;
gdjs.NewSceneCode.condition6IsTrue_0.val = false;
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDworkerObjects3.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDworkerObjects3[i].getVariableNumber(gdjs.NewSceneCode.GDworkerObjects3[i].getVariables().getFromIndex(0)) == 1 ) {
        gdjs.NewSceneCode.condition0IsTrue_0.val = true;
        gdjs.NewSceneCode.GDworkerObjects3[k] = gdjs.NewSceneCode.GDworkerObjects3[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDworkerObjects3.length = k;}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition1IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDtreeObjects3Objects, runtimeScene, true, true);
}if ( gdjs.NewSceneCode.condition1IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition2IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDtownHallObjects3Objects, runtimeScene, true, true);
}if ( gdjs.NewSceneCode.condition2IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition3IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDmineObjects3Objects, runtimeScene, true, true);
}if ( gdjs.NewSceneCode.condition3IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition4IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDcarryObjects3Objects, runtimeScene, true, true);
}if ( gdjs.NewSceneCode.condition4IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition5IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDfarmObjects3Objects, runtimeScene, true, true);
}if ( gdjs.NewSceneCode.condition5IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition6IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(6838404);
}
}}
}
}
}
}
}
if (gdjs.NewSceneCode.condition6IsTrue_0.val) {
/* Reuse gdjs.NewSceneCode.GDworkerObjects3 */
{for(var i = 0, len = gdjs.NewSceneCode.GDworkerObjects3.length ;i < len;++i) {
    gdjs.NewSceneCode.GDworkerObjects3[i].getBehavior("Pathfinding").moveTo(runtimeScene, gdjs.evtTools.input.getMouseX(runtimeScene, "", 0), gdjs.evtTools.input.getMouseY(runtimeScene, "", 0));
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDworkerObjects3.length ;i < len;++i) {
    gdjs.NewSceneCode.GDworkerObjects3[i].returnVariable(gdjs.NewSceneCode.GDworkerObjects3[i].getVariables().getFromIndex(1).getChild("Name")).setString("None");
}
}}

}


{

gdjs.NewSceneCode.GDcarryObjects2.createFrom(runtimeScene.getObjects("carry"));
gdjs.NewSceneCode.GDworkerObjects2.createFrom(runtimeScene.getObjects("worker"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
gdjs.NewSceneCode.condition2IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDcarryObjects2Objects, runtimeScene, true, false);
}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDworkerObjects2.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDworkerObjects2[i].getVariableNumber(gdjs.NewSceneCode.GDworkerObjects2[i].getVariables().getFromIndex(0)) == 1 ) {
        gdjs.NewSceneCode.condition1IsTrue_0.val = true;
        gdjs.NewSceneCode.GDworkerObjects2[k] = gdjs.NewSceneCode.GDworkerObjects2[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDworkerObjects2.length = k;}if ( gdjs.NewSceneCode.condition1IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition2IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(6902484);
}
}}
}
if (gdjs.NewSceneCode.condition2IsTrue_0.val) {
/* Reuse gdjs.NewSceneCode.GDcarryObjects2 */
{for(var i = 0, len = gdjs.NewSceneCode.GDcarryObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDcarryObjects2[i].returnVariable(gdjs.NewSceneCode.GDcarryObjects2[i].getVariables().getFromIndex(0)).setNumber(1);
}
}
{ //Subevents
gdjs.NewSceneCode.eventsList0x68d810(runtimeScene);} //End of subevents
}

}


}; //End of gdjs.NewSceneCode.eventsList0x5b59a0
gdjs.NewSceneCode.eventsList0x69c100 = function(runtimeScene) {

{

gdjs.NewSceneCode.GDworkerObjects2.createFrom(runtimeScene.getObjects("worker"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDworkerObjects2.length;i<l;++i) {
    if ( !(gdjs.NewSceneCode.GDworkerObjects2[i].getBehavior("Pathfinding").pathFound()) ) {
        gdjs.NewSceneCode.condition0IsTrue_0.val = true;
        gdjs.NewSceneCode.GDworkerObjects2[k] = gdjs.NewSceneCode.GDworkerObjects2[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDworkerObjects2.length = k;}if (gdjs.NewSceneCode.condition0IsTrue_0.val) {
gdjs.NewSceneCode.GDmessageObjects2.createFrom(runtimeScene.getObjects("message"));
{for(var i = 0, len = gdjs.NewSceneCode.GDmessageObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDmessageObjects2[i].setString("I can't go there");
}
}}

}


}; //End of gdjs.NewSceneCode.eventsList0x69c100
gdjs.NewSceneCode.userFunc0x664d38 = function(runtimeScene, objects) {

/** @type {gdjs.RuntimeObject} */
const worker = objects[0];

// worker._variables._variables.items.Activity._children.Name._str = 'None';

var message = new MUnitCollectRequestedModel(worker.getUniqueId(), worker._variables._variables.items.Activity.DestinationId);

gdjs.meroSocket.send(MessageTypes.FETCHWAY_REQUESTED, message);
};
gdjs.NewSceneCode.eventsList0x66fc08 = function(runtimeScene) {

{

/* Reuse gdjs.NewSceneCode.GDworkerObjects2 */

var objects = [];
objects.push.apply(objects,gdjs.NewSceneCode.GDworkerObjects2);
gdjs.NewSceneCode.userFunc0x664d38(runtimeScene, objects);

}


}; //End of gdjs.NewSceneCode.eventsList0x66fc08
gdjs.NewSceneCode.userFunc0x65f600 = function(runtimeScene, objects) {

/** @type {gdjs.RuntimeObject} */
const worker = objects[0];

const message = new MUnitReleaseRequestedModel(worker.getUniqueId(), worker._variables._variables.items.Activity.DestinationId);

gdjs.meroSocket.send(MessageTypes.FETCHBACK_REQUESTED, message);
};
gdjs.NewSceneCode.eventsList0x691048 = function(runtimeScene) {

{

/* Reuse gdjs.NewSceneCode.GDworkerObjects1 */

var objects = [];
objects.push.apply(objects,gdjs.NewSceneCode.GDworkerObjects1);
gdjs.NewSceneCode.userFunc0x65f600(runtimeScene, objects);

}


}; //End of gdjs.NewSceneCode.eventsList0x691048
gdjs.NewSceneCode.eventsList0x6a02b0 = function(runtimeScene) {

{

gdjs.NewSceneCode.GDworkerObjects2.createFrom(gdjs.NewSceneCode.GDworkerObjects1);


gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDworkerObjects2.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDworkerObjects2[i].getVariableString(gdjs.NewSceneCode.GDworkerObjects2[i].getVariables().getFromIndex(1).getChild("Name")) == "Fetch_Way" ) {
        gdjs.NewSceneCode.condition0IsTrue_0.val = true;
        gdjs.NewSceneCode.GDworkerObjects2[k] = gdjs.NewSceneCode.GDworkerObjects2[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDworkerObjects2.length = k;}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition1IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(6749484);
}
}}
if (gdjs.NewSceneCode.condition1IsTrue_0.val) {
gdjs.NewSceneCode.GDSelectedMarkerObjects2.createFrom(runtimeScene.getObjects("SelectedMarker"));
/* Reuse gdjs.NewSceneCode.GDworkerObjects2 */
{for(var i = 0, len = gdjs.NewSceneCode.GDSelectedMarkerObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDSelectedMarkerObjects2[i].hide();
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDworkerObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDworkerObjects2[i].returnVariable(gdjs.NewSceneCode.GDworkerObjects2[i].getVariables().getFromIndex(0)).setNumber(0);
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDworkerObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDworkerObjects2[i].hide();
}
}
{ //Subevents
gdjs.NewSceneCode.eventsList0x66fc08(runtimeScene);} //End of subevents
}

}


{

/* Reuse gdjs.NewSceneCode.GDworkerObjects1 */

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDworkerObjects1.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDworkerObjects1[i].getVariableString(gdjs.NewSceneCode.GDworkerObjects1[i].getVariables().getFromIndex(1).getChild("Name")) == "Fetch_Back" ) {
        gdjs.NewSceneCode.condition0IsTrue_0.val = true;
        gdjs.NewSceneCode.GDworkerObjects1[k] = gdjs.NewSceneCode.GDworkerObjects1[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDworkerObjects1.length = k;}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition1IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(6885764);
}
}}
if (gdjs.NewSceneCode.condition1IsTrue_0.val) {

{ //Subevents
gdjs.NewSceneCode.eventsList0x691048(runtimeScene);} //End of subevents
}

}


}; //End of gdjs.NewSceneCode.eventsList0x6a02b0
gdjs.NewSceneCode.eventsList0x664b88 = function(runtimeScene) {

{



}


{

gdjs.NewSceneCode.GDworkerObjects2.createFrom(runtimeScene.getObjects("worker"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDworkerObjects2.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDworkerObjects2[i].getBehavior("Pathfinding").getSpeed() > 0 ) {
        gdjs.NewSceneCode.condition0IsTrue_0.val = true;
        gdjs.NewSceneCode.GDworkerObjects2[k] = gdjs.NewSceneCode.GDworkerObjects2[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDworkerObjects2.length = k;}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition1IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(6680428);
}
}}
if (gdjs.NewSceneCode.condition1IsTrue_0.val) {
}

}


{



}


{

gdjs.NewSceneCode.GDworkerObjects2.createFrom(runtimeScene.getObjects("worker"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDworkerObjects2.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDworkerObjects2[i].getBehavior("Pathfinding").getSpeed() == 0 ) {
        gdjs.NewSceneCode.condition0IsTrue_0.val = true;
        gdjs.NewSceneCode.GDworkerObjects2[k] = gdjs.NewSceneCode.GDworkerObjects2[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDworkerObjects2.length = k;}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition1IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(6942684);
}
}}
if (gdjs.NewSceneCode.condition1IsTrue_0.val) {
gdjs.NewSceneCode.GDmessageObjects2.createFrom(runtimeScene.getObjects("message"));
{for(var i = 0, len = gdjs.NewSceneCode.GDmessageObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDmessageObjects2[i].setString("Waiting for destination");
}
}}

}


{



}


{


gdjs.NewSceneCode.condition0IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.input.isMouseButtonReleased(runtimeScene, "Right");
}if (gdjs.NewSceneCode.condition0IsTrue_0.val) {

{ //Subevents
gdjs.NewSceneCode.eventsList0x5b59a0(runtimeScene);} //End of subevents
}

}


{



}


{


{

{ //Subevents
gdjs.NewSceneCode.eventsList0x69c100(runtimeScene);} //End of subevents
}

}


{

gdjs.NewSceneCode.GDworkerObjects1.createFrom(runtimeScene.getObjects("worker"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDworkerObjects1.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDworkerObjects1[i].getBehavior("Pathfinding").destinationReached() ) {
        gdjs.NewSceneCode.condition0IsTrue_0.val = true;
        gdjs.NewSceneCode.GDworkerObjects1[k] = gdjs.NewSceneCode.GDworkerObjects1[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDworkerObjects1.length = k;}if (gdjs.NewSceneCode.condition0IsTrue_0.val) {

{ //Subevents
gdjs.NewSceneCode.eventsList0x6a02b0(runtimeScene);} //End of subevents
}

}


}; //End of gdjs.NewSceneCode.eventsList0x664b88
gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDBuildButtonObjects1Objects = Hashtable.newFrom({"BuildButton": gdjs.NewSceneCode.GDBuildButtonObjects1});gdjs.NewSceneCode.userFunc0x695c20 = function(runtimeScene, objects) {

var townHall = runtimeScene.getObjects("townHall").find(x => x.getVariables().get("Selected").getAsNumber() === 1);
var townHallId = townHall.getUniqueId();

var messageBody = new MCreationRequestBody(townHallId, "worker", townHall.getX()+townHall.getWidth()+50,  townHall.getY()+ townHall.getHeight());

gdjs.meroSocket.send(MessageTypes.CREATION_REQUESTED, messageBody);
};
gdjs.NewSceneCode.eventsList0x690208 = function(runtimeScene) {

{


var objects = [];
gdjs.NewSceneCode.userFunc0x695c20(runtimeScene, objects);

}


}; //End of gdjs.NewSceneCode.eventsList0x690208
gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDUIPanelObjects1Objects = Hashtable.newFrom({"UIPanel": gdjs.NewSceneCode.GDUIPanelObjects1});gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDworkerObjects2Objects = Hashtable.newFrom({"worker": gdjs.NewSceneCode.GDworkerObjects2});gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDtownHallObjects2Objects = Hashtable.newFrom({"townHall": gdjs.NewSceneCode.GDtownHallObjects2});gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDworkerObjects2Objects = Hashtable.newFrom({"worker": gdjs.NewSceneCode.GDworkerObjects2});gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDtownHallObjects2Objects = Hashtable.newFrom({"townHall": gdjs.NewSceneCode.GDtownHallObjects2});gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDcarryObjects1Objects = Hashtable.newFrom({"carry": gdjs.NewSceneCode.GDcarryObjects1});gdjs.NewSceneCode.userFunc0x7a1eb0 = function(runtimeScene, objects) {


var carry = objects[0];
var newLabel = runtimeScene.createObject("buildingResourceLabel");
newLabel.setLayer("Panel layer");
newLabel.setZOrder(1);
newLabel.setString(carry._variables._variables.items.Stock._value);
setTimeout( function() {
    newLabel.deleteFromScene(runtimeScene);
}, 3000);
};
gdjs.NewSceneCode.eventsList0x7a1d48 = function(runtimeScene) {

{

/* Reuse gdjs.NewSceneCode.GDcarryObjects1 */

var objects = [];
objects.push.apply(objects,gdjs.NewSceneCode.GDcarryObjects1);
gdjs.NewSceneCode.userFunc0x7a1eb0(runtimeScene, objects);

}


}; //End of gdjs.NewSceneCode.eventsList0x7a1d48
gdjs.NewSceneCode.eventsList0x67fe50 = function(runtimeScene) {

{

gdjs.NewSceneCode.GDworkerObjects2.createFrom(runtimeScene.getObjects("worker"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
gdjs.NewSceneCode.condition2IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDworkerObjects2Objects, runtimeScene, true, true);
}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDworkerObjects2.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDworkerObjects2[i].getVariableNumber(gdjs.NewSceneCode.GDworkerObjects2[i].getVariables().getFromIndex(0)) == 1 ) {
        gdjs.NewSceneCode.condition1IsTrue_0.val = true;
        gdjs.NewSceneCode.GDworkerObjects2[k] = gdjs.NewSceneCode.GDworkerObjects2[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDworkerObjects2.length = k;}if ( gdjs.NewSceneCode.condition1IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition2IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(6814796);
}
}}
}
if (gdjs.NewSceneCode.condition2IsTrue_0.val) {
gdjs.NewSceneCode.GDItemBoardLabelObjects2.createFrom(runtimeScene.getObjects("ItemBoardLabel"));
gdjs.NewSceneCode.GDSelectedMarkerObjects2.createFrom(runtimeScene.getObjects("SelectedMarker"));
/* Reuse gdjs.NewSceneCode.GDworkerObjects2 */
{for(var i = 0, len = gdjs.NewSceneCode.GDworkerObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDworkerObjects2[i].returnVariable(gdjs.NewSceneCode.GDworkerObjects2[i].getVariables().getFromIndex(0)).setNumber(0);
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDSelectedMarkerObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDSelectedMarkerObjects2[i].hide();
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDItemBoardLabelObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDItemBoardLabelObjects2[i].hide();
}
}}

}


{

gdjs.NewSceneCode.GDtownHallObjects2.createFrom(runtimeScene.getObjects("townHall"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
gdjs.NewSceneCode.condition2IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDtownHallObjects2Objects, runtimeScene, true, true);
}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDtownHallObjects2.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDtownHallObjects2[i].getVariableNumber(gdjs.NewSceneCode.GDtownHallObjects2[i].getVariables().getFromIndex(0)) == 1 ) {
        gdjs.NewSceneCode.condition1IsTrue_0.val = true;
        gdjs.NewSceneCode.GDtownHallObjects2[k] = gdjs.NewSceneCode.GDtownHallObjects2[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDtownHallObjects2.length = k;}if ( gdjs.NewSceneCode.condition1IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition2IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(6818484);
}
}}
}
if (gdjs.NewSceneCode.condition2IsTrue_0.val) {
gdjs.NewSceneCode.GDBuildButtonObjects2.createFrom(runtimeScene.getObjects("BuildButton"));
gdjs.NewSceneCode.GDItemBoardLabelObjects2.createFrom(runtimeScene.getObjects("ItemBoardLabel"));
/* Reuse gdjs.NewSceneCode.GDtownHallObjects2 */
{for(var i = 0, len = gdjs.NewSceneCode.GDItemBoardLabelObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDItemBoardLabelObjects2[i].hide();
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDBuildButtonObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDBuildButtonObjects2[i].hide();
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDtownHallObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDtownHallObjects2[i].returnVariable(gdjs.NewSceneCode.GDtownHallObjects2[i].getVariables().getFromIndex(0)).setNumber(0);
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDtownHallObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDtownHallObjects2[i].setAnimation(0);
}
}}

}


{

gdjs.NewSceneCode.GDworkerObjects2.createFrom(runtimeScene.getObjects("worker"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
gdjs.NewSceneCode.condition2IsTrue_0.val = false;
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDworkerObjects2.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDworkerObjects2[i].getVariableNumber(gdjs.NewSceneCode.GDworkerObjects2[i].getVariables().getFromIndex(0)) == 0 ) {
        gdjs.NewSceneCode.condition0IsTrue_0.val = true;
        gdjs.NewSceneCode.GDworkerObjects2[k] = gdjs.NewSceneCode.GDworkerObjects2[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDworkerObjects2.length = k;}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition1IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDworkerObjects2Objects, runtimeScene, true, false);
}if ( gdjs.NewSceneCode.condition1IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition2IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(6903364);
}
}}
}
if (gdjs.NewSceneCode.condition2IsTrue_0.val) {
gdjs.NewSceneCode.GDItemBoardLabelObjects2.createFrom(runtimeScene.getObjects("ItemBoardLabel"));
gdjs.NewSceneCode.GDSelectedMarkerObjects2.createFrom(runtimeScene.getObjects("SelectedMarker"));
/* Reuse gdjs.NewSceneCode.GDworkerObjects2 */
{for(var i = 0, len = gdjs.NewSceneCode.GDSelectedMarkerObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDSelectedMarkerObjects2[i].hide(false);
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDItemBoardLabelObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDItemBoardLabelObjects2[i].hide(false);
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDItemBoardLabelObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDItemBoardLabelObjects2[i].setString("Peasant");
}
}{gdjs.evtTools.sound.playSound(runtimeScene, "sounds\\peasant-onclick01.mp3", false, 50, 1);
}{for(var i = 0, len = gdjs.NewSceneCode.GDworkerObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDworkerObjects2[i].returnVariable(gdjs.NewSceneCode.GDworkerObjects2[i].getVariables().getFromIndex(0)).setNumber(1);
}
}}

}


{

gdjs.NewSceneCode.GDtownHallObjects2.createFrom(runtimeScene.getObjects("townHall"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
gdjs.NewSceneCode.condition2IsTrue_0.val = false;
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDtownHallObjects2.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDtownHallObjects2[i].getVariableNumber(gdjs.NewSceneCode.GDtownHallObjects2[i].getVariables().getFromIndex(0)) == 0 ) {
        gdjs.NewSceneCode.condition0IsTrue_0.val = true;
        gdjs.NewSceneCode.GDtownHallObjects2[k] = gdjs.NewSceneCode.GDtownHallObjects2[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDtownHallObjects2.length = k;}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition1IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDtownHallObjects2Objects, runtimeScene, true, false);
}if ( gdjs.NewSceneCode.condition1IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition2IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(6868116);
}
}}
}
if (gdjs.NewSceneCode.condition2IsTrue_0.val) {
gdjs.NewSceneCode.GDBuildButtonObjects2.createFrom(runtimeScene.getObjects("BuildButton"));
gdjs.NewSceneCode.GDItemBoardLabelObjects2.createFrom(runtimeScene.getObjects("ItemBoardLabel"));
/* Reuse gdjs.NewSceneCode.GDtownHallObjects2 */
{for(var i = 0, len = gdjs.NewSceneCode.GDtownHallObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDtownHallObjects2[i].returnVariable(gdjs.NewSceneCode.GDtownHallObjects2[i].getVariables().getFromIndex(0)).setNumber(1);
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDItemBoardLabelObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDItemBoardLabelObjects2[i].setString("Town Hall");
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDItemBoardLabelObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDItemBoardLabelObjects2[i].hide(false);
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDBuildButtonObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDBuildButtonObjects2[i].hide(false);
}
}{gdjs.evtTools.sound.playSound(runtimeScene, "sounds\\townhall-onclick01.mp3", false, 50, 1);
}{for(var i = 0, len = gdjs.NewSceneCode.GDtownHallObjects2.length ;i < len;++i) {
    gdjs.NewSceneCode.GDtownHallObjects2[i].setAnimation(1);
}
}}

}


{

gdjs.NewSceneCode.GDcarryObjects1.createFrom(runtimeScene.getObjects("carry"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDcarryObjects1Objects, runtimeScene, true, false);
}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition1IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(8003156);
}
}}
if (gdjs.NewSceneCode.condition1IsTrue_0.val) {

{ //Subevents
gdjs.NewSceneCode.eventsList0x7a1d48(runtimeScene);} //End of subevents
}

}


}; //End of gdjs.NewSceneCode.eventsList0x67fe50
gdjs.NewSceneCode.eventsList0xb2358 = function(runtimeScene) {

{


gdjs.NewSceneCode.condition0IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.runtimeScene.sceneJustBegins(runtimeScene);
}if (gdjs.NewSceneCode.condition0IsTrue_0.val) {
gdjs.NewSceneCode.GDBuildButtonObjects1.createFrom(runtimeScene.getObjects("BuildButton"));
gdjs.NewSceneCode.GDErrorLabelObjects1.createFrom(runtimeScene.getObjects("ErrorLabel"));
gdjs.NewSceneCode.GDItemBoardLabelObjects1.createFrom(runtimeScene.getObjects("ItemBoardLabel"));
gdjs.NewSceneCode.GDSelectedMarkerObjects1.createFrom(runtimeScene.getObjects("SelectedMarker"));
gdjs.NewSceneCode.GDworkerObjects1.createFrom(runtimeScene.getObjects("worker"));
{gdjs.evtTools.camera.showLayer(runtimeScene, "Panel layer");
}{for(var i = 0, len = gdjs.NewSceneCode.GDItemBoardLabelObjects1.length ;i < len;++i) {
    gdjs.NewSceneCode.GDItemBoardLabelObjects1[i].hide();
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDSelectedMarkerObjects1.length ;i < len;++i) {
    gdjs.NewSceneCode.GDSelectedMarkerObjects1[i].hide();
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDworkerObjects1.length ;i < len;++i) {
    gdjs.NewSceneCode.GDworkerObjects1[i].setZOrder(1);
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDBuildButtonObjects1.length ;i < len;++i) {
    gdjs.NewSceneCode.GDBuildButtonObjects1[i].hide();
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDErrorLabelObjects1.length ;i < len;++i) {
    gdjs.NewSceneCode.GDErrorLabelObjects1[i].hide();
}
}{gdjs.evtTools.runtimeScene.resetTimer(runtimeScene, "unitsStateTimer");
}
{ //Subevents
gdjs.NewSceneCode.eventsList0x6fcbb8(runtimeScene);} //End of subevents
}

}


{


gdjs.NewSceneCode.eventsList0x664b88(runtimeScene);
}


{



}


{

gdjs.NewSceneCode.GDBackgroundObjects1.createFrom(runtimeScene.getObjects("Background"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.input.isKeyPressed(runtimeScene, "Right");
}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition1IsTrue_0.val = gdjs.evtTools.camera.getCameraX(runtimeScene, "", 0) <= (( gdjs.NewSceneCode.GDBackgroundObjects1.length === 0 ) ? 0 :gdjs.NewSceneCode.GDBackgroundObjects1[0].getWidth()) - (gdjs.evtTools.window.getCanvasWidth(runtimeScene) / 2) - 20;
}}
if (gdjs.NewSceneCode.condition1IsTrue_0.val) {
{gdjs.evtTools.camera.setCameraX(runtimeScene, gdjs.evtTools.camera.getCameraX(runtimeScene, "", 0) + (20), "", 0);
}}

}


{


gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.input.isKeyPressed(runtimeScene, "Left");
}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition1IsTrue_0.val = gdjs.evtTools.camera.getCameraX(runtimeScene, "", 0) >= (gdjs.evtTools.window.getCanvasWidth(runtimeScene) / 2) + 20;
}}
if (gdjs.NewSceneCode.condition1IsTrue_0.val) {
{gdjs.evtTools.camera.setCameraX(runtimeScene, gdjs.evtTools.camera.getCameraX(runtimeScene, "", 0) - (20), "", 0);
}}

}


{


gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.input.isKeyPressed(runtimeScene, "Up");
}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition1IsTrue_0.val = gdjs.evtTools.camera.getCameraY(runtimeScene, "", 0) >= (gdjs.evtTools.window.getCanvasHeight(runtimeScene) / 2) + 20;
}}
if (gdjs.NewSceneCode.condition1IsTrue_0.val) {
{gdjs.evtTools.camera.setCameraY(runtimeScene, gdjs.evtTools.camera.getCameraY(runtimeScene, "", 0) - (20), "", 0);
}}

}


{

gdjs.NewSceneCode.GDBackgroundObjects1.createFrom(runtimeScene.getObjects("Background"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.input.isKeyPressed(runtimeScene, "Down");
}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition1IsTrue_0.val = gdjs.evtTools.camera.getCameraY(runtimeScene, "", 0) <= (( gdjs.NewSceneCode.GDBackgroundObjects1.length === 0 ) ? 0 :gdjs.NewSceneCode.GDBackgroundObjects1[0].getHeight()) - (gdjs.evtTools.window.getCanvasHeight(runtimeScene) / 2) + 240;
}}
if (gdjs.NewSceneCode.condition1IsTrue_0.val) {
{gdjs.evtTools.camera.setCameraY(runtimeScene, gdjs.evtTools.camera.getCameraY(runtimeScene, "", 0) + (20), "", 0);
}}

}


{

gdjs.NewSceneCode.GDBuildButtonObjects1.createFrom(runtimeScene.getObjects("BuildButton"));
gdjs.NewSceneCode.GDtownHallObjects1.createFrom(runtimeScene.getObjects("townHall"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
gdjs.NewSceneCode.condition2IsTrue_0.val = false;
gdjs.NewSceneCode.condition3IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.input.isMouseButtonPressed(runtimeScene, "Left");
}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition1IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDBuildButtonObjects1Objects, runtimeScene, true, false);
}if ( gdjs.NewSceneCode.condition1IsTrue_0.val ) {
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDtownHallObjects1.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDtownHallObjects1[i].getVariableNumber(gdjs.NewSceneCode.GDtownHallObjects1[i].getVariables().getFromIndex(0)) == 1 ) {
        gdjs.NewSceneCode.condition2IsTrue_0.val = true;
        gdjs.NewSceneCode.GDtownHallObjects1[k] = gdjs.NewSceneCode.GDtownHallObjects1[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDtownHallObjects1.length = k;}if ( gdjs.NewSceneCode.condition2IsTrue_0.val ) {
{
{gdjs.NewSceneCode.conditionTrue_1 = gdjs.NewSceneCode.condition3IsTrue_0;
gdjs.NewSceneCode.conditionTrue_1.val = runtimeScene.getOnceTriggers().triggerOnce(6930172);
}
}}
}
}
if (gdjs.NewSceneCode.condition3IsTrue_0.val) {

{ //Subevents
gdjs.NewSceneCode.eventsList0x690208(runtimeScene);} //End of subevents
}

}


{



}


{

gdjs.NewSceneCode.GDUIPanelObjects1.createFrom(runtimeScene.getObjects("UIPanel"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
gdjs.NewSceneCode.condition1IsTrue_0.val = false;
{
gdjs.NewSceneCode.condition0IsTrue_0.val = gdjs.evtTools.input.isMouseButtonPressed(runtimeScene, "Left");
}if ( gdjs.NewSceneCode.condition0IsTrue_0.val ) {
{
gdjs.NewSceneCode.condition1IsTrue_0.val = gdjs.evtTools.input.cursorOnObject(gdjs.NewSceneCode.mapOfGDgdjs_46NewSceneCode_46GDUIPanelObjects1Objects, runtimeScene, true, true);
}}
if (gdjs.NewSceneCode.condition1IsTrue_0.val) {

{ //Subevents
gdjs.NewSceneCode.eventsList0x67fe50(runtimeScene);} //End of subevents
}

}


{

gdjs.NewSceneCode.GDworkerObjects1.createFrom(runtimeScene.getObjects("worker"));

gdjs.NewSceneCode.condition0IsTrue_0.val = false;
{
for(var i = 0, k = 0, l = gdjs.NewSceneCode.GDworkerObjects1.length;i<l;++i) {
    if ( gdjs.NewSceneCode.GDworkerObjects1[i].getVariableNumber(gdjs.NewSceneCode.GDworkerObjects1[i].getVariables().getFromIndex(0)) == 1 ) {
        gdjs.NewSceneCode.condition0IsTrue_0.val = true;
        gdjs.NewSceneCode.GDworkerObjects1[k] = gdjs.NewSceneCode.GDworkerObjects1[i];
        ++k;
    }
}
gdjs.NewSceneCode.GDworkerObjects1.length = k;}if (gdjs.NewSceneCode.condition0IsTrue_0.val) {
gdjs.NewSceneCode.GDSelectedMarkerObjects1.createFrom(runtimeScene.getObjects("SelectedMarker"));
/* Reuse gdjs.NewSceneCode.GDworkerObjects1 */
{for(var i = 0, len = gdjs.NewSceneCode.GDSelectedMarkerObjects1.length ;i < len;++i) {
    gdjs.NewSceneCode.GDSelectedMarkerObjects1[i].putAroundObject((gdjs.NewSceneCode.GDworkerObjects1.length !== 0 ? gdjs.NewSceneCode.GDworkerObjects1[0] : null), 0, 0);
}
}{for(var i = 0, len = gdjs.NewSceneCode.GDSelectedMarkerObjects1.length ;i < len;++i) {
    gdjs.NewSceneCode.GDSelectedMarkerObjects1[i].setScale(1);
}
}}

}


}; //End of gdjs.NewSceneCode.eventsList0xb2358


gdjs.NewSceneCode.func = function(runtimeScene) {
runtimeScene.getOnceTriggers().startNewFrame();
gdjs.NewSceneCode.GDworkerObjects1.length = 0;
gdjs.NewSceneCode.GDworkerObjects2.length = 0;
gdjs.NewSceneCode.GDworkerObjects3.length = 0;
gdjs.NewSceneCode.GDworkerObjects4.length = 0;
gdjs.NewSceneCode.GDmessageObjects1.length = 0;
gdjs.NewSceneCode.GDmessageObjects2.length = 0;
gdjs.NewSceneCode.GDmessageObjects3.length = 0;
gdjs.NewSceneCode.GDmessageObjects4.length = 0;
gdjs.NewSceneCode.GDmessage2Objects1.length = 0;
gdjs.NewSceneCode.GDmessage2Objects2.length = 0;
gdjs.NewSceneCode.GDmessage2Objects3.length = 0;
gdjs.NewSceneCode.GDmessage2Objects4.length = 0;
gdjs.NewSceneCode.GDItemBoardLabelObjects1.length = 0;
gdjs.NewSceneCode.GDItemBoardLabelObjects2.length = 0;
gdjs.NewSceneCode.GDItemBoardLabelObjects3.length = 0;
gdjs.NewSceneCode.GDItemBoardLabelObjects4.length = 0;
gdjs.NewSceneCode.GDtreeObjects1.length = 0;
gdjs.NewSceneCode.GDtreeObjects2.length = 0;
gdjs.NewSceneCode.GDtreeObjects3.length = 0;
gdjs.NewSceneCode.GDtreeObjects4.length = 0;
gdjs.NewSceneCode.GDBackgroundObjects1.length = 0;
gdjs.NewSceneCode.GDBackgroundObjects2.length = 0;
gdjs.NewSceneCode.GDBackgroundObjects3.length = 0;
gdjs.NewSceneCode.GDBackgroundObjects4.length = 0;
gdjs.NewSceneCode.GDUIPanelObjects1.length = 0;
gdjs.NewSceneCode.GDUIPanelObjects2.length = 0;
gdjs.NewSceneCode.GDUIPanelObjects3.length = 0;
gdjs.NewSceneCode.GDUIPanelObjects4.length = 0;
gdjs.NewSceneCode.GDSelectedMarkerObjects1.length = 0;
gdjs.NewSceneCode.GDSelectedMarkerObjects2.length = 0;
gdjs.NewSceneCode.GDSelectedMarkerObjects3.length = 0;
gdjs.NewSceneCode.GDSelectedMarkerObjects4.length = 0;
gdjs.NewSceneCode.GDtownHallObjects1.length = 0;
gdjs.NewSceneCode.GDtownHallObjects2.length = 0;
gdjs.NewSceneCode.GDtownHallObjects3.length = 0;
gdjs.NewSceneCode.GDtownHallObjects4.length = 0;
gdjs.NewSceneCode.GDBuildButtonObjects1.length = 0;
gdjs.NewSceneCode.GDBuildButtonObjects2.length = 0;
gdjs.NewSceneCode.GDBuildButtonObjects3.length = 0;
gdjs.NewSceneCode.GDBuildButtonObjects4.length = 0;
gdjs.NewSceneCode.GDGoldStockLabelObjects1.length = 0;
gdjs.NewSceneCode.GDGoldStockLabelObjects2.length = 0;
gdjs.NewSceneCode.GDGoldStockLabelObjects3.length = 0;
gdjs.NewSceneCode.GDGoldStockLabelObjects4.length = 0;
gdjs.NewSceneCode.GDStoneStockLabelObjects1.length = 0;
gdjs.NewSceneCode.GDStoneStockLabelObjects2.length = 0;
gdjs.NewSceneCode.GDStoneStockLabelObjects3.length = 0;
gdjs.NewSceneCode.GDStoneStockLabelObjects4.length = 0;
gdjs.NewSceneCode.GDWoodStockLabelObjects1.length = 0;
gdjs.NewSceneCode.GDWoodStockLabelObjects2.length = 0;
gdjs.NewSceneCode.GDWoodStockLabelObjects3.length = 0;
gdjs.NewSceneCode.GDWoodStockLabelObjects4.length = 0;
gdjs.NewSceneCode.GDGoldStockIconObjects1.length = 0;
gdjs.NewSceneCode.GDGoldStockIconObjects2.length = 0;
gdjs.NewSceneCode.GDGoldStockIconObjects3.length = 0;
gdjs.NewSceneCode.GDGoldStockIconObjects4.length = 0;
gdjs.NewSceneCode.GDStoneStockIconObjects1.length = 0;
gdjs.NewSceneCode.GDStoneStockIconObjects2.length = 0;
gdjs.NewSceneCode.GDStoneStockIconObjects3.length = 0;
gdjs.NewSceneCode.GDStoneStockIconObjects4.length = 0;
gdjs.NewSceneCode.GDWoodStockIconObjects1.length = 0;
gdjs.NewSceneCode.GDWoodStockIconObjects2.length = 0;
gdjs.NewSceneCode.GDWoodStockIconObjects3.length = 0;
gdjs.NewSceneCode.GDWoodStockIconObjects4.length = 0;
gdjs.NewSceneCode.GDMaxPopulationIconObjects1.length = 0;
gdjs.NewSceneCode.GDMaxPopulationIconObjects2.length = 0;
gdjs.NewSceneCode.GDMaxPopulationIconObjects3.length = 0;
gdjs.NewSceneCode.GDMaxPopulationIconObjects4.length = 0;
gdjs.NewSceneCode.GDcarryObjects1.length = 0;
gdjs.NewSceneCode.GDcarryObjects2.length = 0;
gdjs.NewSceneCode.GDcarryObjects3.length = 0;
gdjs.NewSceneCode.GDcarryObjects4.length = 0;
gdjs.NewSceneCode.GDmineObjects1.length = 0;
gdjs.NewSceneCode.GDmineObjects2.length = 0;
gdjs.NewSceneCode.GDmineObjects3.length = 0;
gdjs.NewSceneCode.GDmineObjects4.length = 0;
gdjs.NewSceneCode.GDfarmObjects1.length = 0;
gdjs.NewSceneCode.GDfarmObjects2.length = 0;
gdjs.NewSceneCode.GDfarmObjects3.length = 0;
gdjs.NewSceneCode.GDfarmObjects4.length = 0;
gdjs.NewSceneCode.GDrallyPointObjects1.length = 0;
gdjs.NewSceneCode.GDrallyPointObjects2.length = 0;
gdjs.NewSceneCode.GDrallyPointObjects3.length = 0;
gdjs.NewSceneCode.GDrallyPointObjects4.length = 0;
gdjs.NewSceneCode.GDErrorLabelObjects1.length = 0;
gdjs.NewSceneCode.GDErrorLabelObjects2.length = 0;
gdjs.NewSceneCode.GDErrorLabelObjects3.length = 0;
gdjs.NewSceneCode.GDErrorLabelObjects4.length = 0;
gdjs.NewSceneCode.GDbuildingResourceLabelObjects1.length = 0;
gdjs.NewSceneCode.GDbuildingResourceLabelObjects2.length = 0;
gdjs.NewSceneCode.GDbuildingResourceLabelObjects3.length = 0;
gdjs.NewSceneCode.GDbuildingResourceLabelObjects4.length = 0;
gdjs.NewSceneCode.GDTitleResourcesLabelObjects1.length = 0;
gdjs.NewSceneCode.GDTitleResourcesLabelObjects2.length = 0;
gdjs.NewSceneCode.GDTitleResourcesLabelObjects3.length = 0;
gdjs.NewSceneCode.GDTitleResourcesLabelObjects4.length = 0;
gdjs.NewSceneCode.GDTitleActionsLabelObjects1.length = 0;
gdjs.NewSceneCode.GDTitleActionsLabelObjects2.length = 0;
gdjs.NewSceneCode.GDTitleActionsLabelObjects3.length = 0;
gdjs.NewSceneCode.GDTitleActionsLabelObjects4.length = 0;
gdjs.NewSceneCode.GDMaxPopulationLabelObjects1.length = 0;
gdjs.NewSceneCode.GDMaxPopulationLabelObjects2.length = 0;
gdjs.NewSceneCode.GDMaxPopulationLabelObjects3.length = 0;
gdjs.NewSceneCode.GDMaxPopulationLabelObjects4.length = 0;

gdjs.NewSceneCode.eventsList0xb2358(runtimeScene);
return;
}
gdjs['NewSceneCode'] = gdjs.NewSceneCode;
